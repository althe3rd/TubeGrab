version: "3.8"

services:
  tubegrab:
    build: .
    container_name: tubegrab
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      # Downloads directory - default location for downloads
      # For Unraid: /mnt/user/downloads/youtube:/downloads
      - ./downloads:/downloads
      
      # Plex Movies directory - videos with "Send to Plex" enabled go here
      # For Unraid: /mnt/user/data/media/movies:/plex/movies
      - ./plex/movies:/plex/movies
      
      # Plex Music directory - audio with "Send to Plex" enabled goes here
      # For Unraid: /mnt/user/data/media/music:/plex/music
      - ./plex/music:/plex/music
      
      # Optional: Cache directory for yt-dlp (speeds up repeated requests)
      - ./cache:/root/.cache/yt-dlp
    environment:
      # Set your timezone
      - TZ=America/Chicago
      # Plex directory paths (these match the container paths above)
      - PLEX_MOVIES_DIR=/plex/movies
      - PLEX_MUSIC_DIR=/plex/music
    # Uncomment below to enable NVIDIA GPU support for video conversion
    # Requires NVIDIA Container Toolkit or nvidia-docker
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

# =============================================================================
# UNRAID SETUP INSTRUCTIONS
# =============================================================================
#
# Volume Mappings for Unraid:
# ---------------------------
# Container Path          | Host Path (example)
# /downloads              | /mnt/user/downloads/youtube
# /plex/movies            | /mnt/user/data/media/movies
# /plex/music             | /mnt/user/data/media/music
# /root/.cache/yt-dlp     | /mnt/user/appdata/tubegrab/cache
#
# The Plex paths should match where your Plex server looks for media.
# This allows downloaded content to appear directly in your Plex library.
#
# Environment Variables:
# ----------------------
# TZ                      | Your timezone (e.g., America/Chicago)
# PLEX_MOVIES_DIR         | /plex/movies (container path, don't change)
# PLEX_MUSIC_DIR          | /plex/music (container path, don't change)
#
# NVIDIA GPU Support (for video conversion):
# ------------------------------------------
# To enable hardware-accelerated video conversion on Unraid:
# 1. Install "Nvidia Driver" plugin from Community Applications
# 2. Install your preferred NVIDIA driver version
# 3. RESTART YOUR UNRAID SERVER (required for driver to be active)
# 4. In Docker container settings, add these Variables:
#    - NVIDIA_VISIBLE_DEVICES=all
#    - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
#    OR add to Extra Parameters: --gpus all
# 5. The app will automatically detect and use GPU if available
#    (falls back to software encoding if GPU not available)
# 
# Note: If --gpus all causes container to fail, use environment variables instead
#
# =============================================================================
